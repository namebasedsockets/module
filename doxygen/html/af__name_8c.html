<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Name-based sockets - module: af_name.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>af_name.c File Reference</h1>
<p>AF_NAME behavior.  
<a href="#_details">More...</a></p>
<code>#include &lt;linux/ctype.h&gt;</code><br/>
<code>#include &lt;linux/types.h&gt;</code><br/>
<code>#include &lt;linux/socket.h&gt;</code><br/>
<code>#include &lt;linux/in.h&gt;</code><br/>
<code>#include &lt;linux/ipv6.h&gt;</code><br/>
<code>#include &lt;linux/net.h&gt;</code><br/>
<code>#include &lt;linux/module.h&gt;</code><br/>
<code>#include &lt;net/sock.h&gt;</code><br/>
<code>#include &lt;net/inet_connection_sock.h&gt;</code><br/>
<code>#include &lt;net/inet6_hashtables.h&gt;</code><br/>
<code>#include &lt;net/ipv6.h&gt;</code><br/>
<code>#include &lt;net/tcp_states.h&gt;</code><br/>
<code>#include &lt;net/transp_v6.h&gt;</code><br/>
<code>#include &lt;linux/inname.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="af__name_8c_source.html">dns.h</a>&quot;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<div class="dynheader">
Include dependency graph for af_name.c:</div>
<div class="dynsection">
</div>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
</div>

<p><a href="af__name_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structname__opt__hdr.html">name_opt_hdr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsyn__entry.html">syn_entry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structname__dgram__sock.html">name_dgram_sock</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="af__name_8c.html#aa8c3331a282a806f6be4407fb838f0f1">NAME_OPTION_SOURCE_NAME</a>&nbsp;&nbsp;&nbsp;17</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a27e27a3ec80a8830a34cfc4313b261ad"></a><!-- doxytag: member="af_name.c::NAME_OPTION_DEST_NAME" ref="a27e27a3ec80a8830a34cfc4313b261ad" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NAME_OPTION_DEST_NAME</b>&nbsp;&nbsp;&nbsp;18</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab0d1446d191ef9a97f571715861aa15e"></a><!-- doxytag: member="af_name.c::NAME_SYN_BUCKETS" ref="ab0d1446d191ef9a97f571715861aa15e" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NAME_SYN_BUCKETS</b>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <b>NAME_RESOLVING</b> =  TCP_MAX_STATES, 
<b>NAME_BINDING</b>, 
<b>NAME_CONNECTING</b>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <b>NAMEF_RESOLVING</b> =  (1 &lt;&lt; NAME_RESOLVING), 
<b>NAMEF_BINDING</b> =  (1 &lt;&lt; NAME_BINDING), 
<b>NAMEF_CONNECTING</b> =  (1 &lt;&lt; NAME_CONNECTING)
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct ipv6_txoptions *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="af__name_8c.html#a7b0682716a3329de6d42caba391f374d">namestack_ipv6_renew_options</a> (struct sock *sk, struct ipv6_txoptions *opt, int newtype, struct ipv6_opt_hdr *newopt, int newoptlen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba97cdc2d426374e9a939e5cd64f3c6d"></a><!-- doxytag: member="af_name.c::name_af_init" ref="aba97cdc2d426374e9a939e5cd64f3c6d" args="(void)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>name_af_init</b> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac37ce9d7d05a92ecd217351dfc571834"></a><!-- doxytag: member="af_name.c::name_af_exit" ref="ac37ce9d7d05a92ecd217351dfc571834" args="(void)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>name_af_exit</b> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a638bb3dff0c45739bbba5adb6bd3d250"></a><!-- doxytag: member="af_name.c::EXPORT_SYMBOL" ref="a638bb3dff0c45739bbba5adb6bd3d250" args="(name_af_init)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>EXPORT_SYMBOL</b> (name_af_init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a93456d926d977e7008ab10b395eccf0b"></a><!-- doxytag: member="af_name.c::EXPORT_SYMBOL" ref="a93456d926d977e7008ab10b395eccf0b" args="(name_af_exit)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>EXPORT_SYMBOL</b> (name_af_exit)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>AF_NAME behavior. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Juan Lang </dd>
<dd>
Javier Ubillos </dd>
<dd>
Mattias Ekstr√∂m </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011-01-18 </dd></dl>

<p>Definition in file <a class="el" href="af__name_8c_source.html">af_name.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aa8c3331a282a806f6be4407fb838f0f1"></a><!-- doxytag: member="af_name.c::NAME_OPTION_SOURCE_NAME" ref="aa8c3331a282a806f6be4407fb838f0f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAME_OPTION_SOURCE_NAME&nbsp;&nbsp;&nbsp;17</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>FIXME: Change name options to the "real" values once they're known. Must &lt;= 63. </p>

<p>Definition at line <a class="el" href="af__name_8c_source.html#l00315">315</a> of file <a class="el" href="af__name_8c_source.html">af_name.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a06fc87d81c62e9abb8790b6e5713c55b"></a><!-- doxytag: member="af_name.c::@0" ref="a06fc87d81c62e9abb8790b6e5713c55b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enum for namestack states, these should _not_ overlap with TCP states </p>

<p>Definition at line <a class="el" href="af__name_8c_source.html#l00028">28</a> of file <a class="el" href="af__name_8c_source.html">af_name.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00028"></a>00028      {
<a name="l00029"></a>00029         NAME_RESOLVING = TCP_MAX_STATES, <span class="comment">/* Don&#39;t overlap with TCP states */</span>
<a name="l00030"></a>00030         NAME_BINDING,
<a name="l00031"></a>00031         NAME_CONNECTING,
<a name="l00032"></a>00032 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf764cbdea00d65edcd07bb9953ad2b7"></a><!-- doxytag: member="af_name.c::@1" ref="adf764cbdea00d65edcd07bb9953ad2b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Bit-mask enum for namestack states, these should _not_ overlap with TCP states </p>

<p>Definition at line <a class="el" href="af__name_8c_source.html#l00035">35</a> of file <a class="el" href="af__name_8c_source.html">af_name.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00035"></a>00035      {
<a name="l00036"></a>00036         NAMEF_RESOLVING   = (1 &lt;&lt; NAME_RESOLVING),
<a name="l00037"></a>00037         NAMEF_BINDING     = (1 &lt;&lt; NAME_BINDING),
<a name="l00038"></a>00038         NAMEF_CONNECTING  = (1 &lt;&lt; NAME_CONNECTING),
<a name="l00039"></a>00039 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7b0682716a3329de6d42caba391f374d"></a><!-- doxytag: member="af_name.c::namestack_ipv6_renew_options" ref="a7b0682716a3329de6d42caba391f374d" args="(struct sock *sk, struct ipv6_txoptions *opt, int newtype, struct ipv6_opt_hdr *newopt, int newoptlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct ipv6_txoptions* namestack_ipv6_renew_options </td>
          <td>(</td>
          <td class="paramtype">struct sock *&nbsp;</td>
          <td class="paramname"> <em>sk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ipv6_txoptions *&nbsp;</td>
          <td class="paramname"> <em>opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>newtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ipv6_opt_hdr *&nbsp;</td>
          <td class="paramname"> <em>newopt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>newoptlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Identical to ipv6_renew_options in net/ipv6/exthdrs.c, but calls the modified ipv6_renew_option (above). </p>

<p>Definition at line <a class="el" href="af__name_8c_source.html#l00234">234</a> of file <a class="el" href="af__name_8c_source.html">af_name.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00237"></a>00237 {
<a name="l00238"></a>00238         <span class="keywordtype">int</span> tot_len = 0;
<a name="l00239"></a>00239         <span class="keywordtype">char</span> *p;
<a name="l00240"></a>00240         <span class="keyword">struct </span>ipv6_txoptions *opt2;
<a name="l00241"></a>00241         <span class="keywordtype">int</span> err;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <span class="keywordflow">if</span> (opt) {
<a name="l00244"></a>00244                 <span class="keywordflow">if</span> (newtype != IPV6_HOPOPTS &amp;&amp; opt-&gt;hopopt)
<a name="l00245"></a>00245                         tot_len += CMSG_ALIGN(ipv6_optlen(opt-&gt;hopopt));
<a name="l00246"></a>00246                 <span class="keywordflow">if</span> (newtype != IPV6_RTHDRDSTOPTS &amp;&amp; opt-&gt;dst0opt)
<a name="l00247"></a>00247                         tot_len += CMSG_ALIGN(ipv6_optlen(opt-&gt;dst0opt));
<a name="l00248"></a>00248                 <span class="keywordflow">if</span> (newtype != IPV6_RTHDR &amp;&amp; opt-&gt;srcrt)
<a name="l00249"></a>00249                         tot_len += CMSG_ALIGN(ipv6_optlen(opt-&gt;srcrt));
<a name="l00250"></a>00250                 <span class="keywordflow">if</span> (newtype != IPV6_DSTOPTS &amp;&amp; opt-&gt;dst1opt)
<a name="l00251"></a>00251                         tot_len += CMSG_ALIGN(ipv6_optlen(opt-&gt;dst1opt));
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <span class="keywordflow">if</span> (newopt &amp;&amp; newoptlen)
<a name="l00255"></a>00255                 tot_len += CMSG_ALIGN(newoptlen);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (!tot_len)
<a name="l00258"></a>00258                 <span class="keywordflow">return</span> NULL;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         tot_len += <span class="keyword">sizeof</span>(*opt2);
<a name="l00261"></a>00261         opt2 = sock_kmalloc(sk, tot_len, GFP_ATOMIC);
<a name="l00262"></a>00262         <span class="keywordflow">if</span> (!opt2)
<a name="l00263"></a>00263                 <span class="keywordflow">return</span> ERR_PTR(-ENOBUFS);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         memset(opt2, 0, tot_len);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         opt2-&gt;tot_len = tot_len;
<a name="l00268"></a>00268         p = (<span class="keywordtype">char</span> *)(opt2 + 1);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         err = ipv6_renew_option(opt ? opt-&gt;hopopt : NULL, newopt, newoptlen,
<a name="l00271"></a>00271                                 newtype != IPV6_HOPOPTS,
<a name="l00272"></a>00272                                 &amp;opt2-&gt;hopopt, &amp;p);
<a name="l00273"></a>00273         <span class="keywordflow">if</span> (err)
<a name="l00274"></a>00274                 <span class="keywordflow">goto</span> out;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         err = ipv6_renew_option(opt ? opt-&gt;dst0opt : NULL, newopt, newoptlen,
<a name="l00277"></a>00277                                 newtype != IPV6_RTHDRDSTOPTS,
<a name="l00278"></a>00278                                 &amp;opt2-&gt;dst0opt, &amp;p);
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (err)
<a name="l00280"></a>00280                 <span class="keywordflow">goto</span> out;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         err = ipv6_renew_option(opt ? opt-&gt;srcrt : NULL, newopt, newoptlen,
<a name="l00283"></a>00283                                 newtype != IPV6_RTHDR,
<a name="l00284"></a>00284                                 (<span class="keyword">struct</span> ipv6_opt_hdr **)&amp;opt2-&gt;srcrt, &amp;p);
<a name="l00285"></a>00285         <span class="keywordflow">if</span> (err)
<a name="l00286"></a>00286                 <span class="keywordflow">goto</span> out;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         err = ipv6_renew_option(opt ? opt-&gt;dst1opt : NULL, newopt, newoptlen,
<a name="l00289"></a>00289                                 newtype != IPV6_DSTOPTS,
<a name="l00290"></a>00290                                 &amp;opt2-&gt;dst1opt, &amp;p);
<a name="l00291"></a>00291         <span class="keywordflow">if</span> (err)
<a name="l00292"></a>00292                 <span class="keywordflow">goto</span> out;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         opt2-&gt;opt_nflen = (opt2-&gt;hopopt ? ipv6_optlen(opt2-&gt;hopopt) : 0) +
<a name="l00295"></a>00295                           (opt2-&gt;dst0opt ? ipv6_optlen(opt2-&gt;dst0opt) : 0) +
<a name="l00296"></a>00296                           (opt2-&gt;srcrt ? ipv6_optlen(opt2-&gt;srcrt) : 0);
<a name="l00297"></a>00297         opt2-&gt;opt_flen = (opt2-&gt;dst1opt ? ipv6_optlen(opt2-&gt;dst1opt) : 0);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keywordflow">return</span> opt2;
<a name="l00300"></a>00300 out:
<a name="l00301"></a>00301         sock_kfree_s(sk, opt2, opt2-&gt;tot_len);
<a name="l00302"></a>00302         <span class="keywordflow">return</span> ERR_PTR(err);
<a name="l00303"></a>00303 }
</pre></div></p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jan 18 20:34:38 2011 for Name-based sockets - module by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
